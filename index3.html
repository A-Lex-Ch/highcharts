<!doctype html>
<!--[if lt IE 7 ]><html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]><html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]><html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]><html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><html lang="en" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8" />
    <meta name="author" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Тивун</title>

            <link rel="stylesheet" href="admin-lte-all.css" />


    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

                <script type="text/javascript" src="/bundles/avanzuadmintheme/static/prod/scripts/modernizr.js"></script>
				<script type="text/javascript" src="highcharts.js"></script>
				<script type="text/javascript" src="highcharts-more.js"></script>
				<script type="text/javascript" src="exporting.js"></script>
        <!--[if lt IE 9]>

        <![endif]-->

    
</head>
<body class="skin-green">
<div class="wrapper">

            <header class="main-header">
                 <a href="#" class="logo">
         <img src="/bundles/app/images/logo.png" height="40px">
         <!-- Add the class icon to your logo image or logo icon to add the margining -->
        Тивун
     </a>
             <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>
                                    <div class="navbar-custom-menu">
                        <ul class="nav navbar-nav">
                                                            <!-- Notifications: style can be found in dropdown.less -->
<li class="dropdown notifications-menu">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
        <i class="fa fa-bell-o"></i>
        <span class="label label-warning">4</span>
    </a>
    <ul class="dropdown-menu">
        <li class="header">You have 4 notifications</li>
        <li>
            <!-- inner menu: contains the actual data -->
            <ul class="menu">
                                    <li>
                        <a href="/host/10110">
                            <i class="fa fa-warning info"></i> Marlboro::Scenario failed: Authorization
                        </a>
                    </li>
                                    <li>
                        <a href="/host/10110">
                            <i class="fa fa-warning info"></i> Marlboro::Response timeout: Authorization
                        </a>
                    </li>
                                    <li>
                        <a href="/host/10107">
                            <i class="fa fa-warning info"></i> Bondstreet::Scenario failed: Authorization
                        </a>
                    </li>
                                    <li>
                        <a href="/host/10113">
                            <i class="fa fa-warning info"></i> Smartluxury::Scenario failed: Authorization
                        </a>
                    </li>
                            </ul>
        </li>
        <!--<li class="footer"><a href="/notifications/">View all</a></li>-->
    </ul>
</li>
                                <!-- User Account: style can be found in dropdown.less -->
<li class="dropdown user user-menu">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <img src="/bundles/avanzuadmintheme/img/avatar.png" class="user-image" alt="Admin" />
    
        <span class="hidden-xs">Admin</span>
    </a>
    <ul class="dropdown-menu">
        <!-- User image -->
        <li class="user-header">
                        <img src="/bundles/avanzuadmintheme/img/avatar.png" class="img-circle" alt="Admin" />
    
            <p>
                Denis - Khorikov
                <!--<small>Member since 04.2017</small>-->
            </p>
        </li>
        <!-- Menu Footer-->
        <li class="user-footer">
            <div class="pull-left">
                <a href="#" id='profileLink' class="btn btn-default btn-flat">Profile</a>
            </div>
            <div class="pull-right">
                <a href="/logout" class="btn btn-default btn-flat">Sign out</a>
            </div>
        </li>
    </ul>
</li>

                                                    </ul>
                    </div>
                            </nav>
        </header>
    
    <!-- Left side column. contains the logo and sidebar -->
    <aside class="main-sidebar sidebar-offcanvas">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
                            
                                <!-- sidebar menu: : style can be found in sidebar.less -->
<ul class="sidebar-menu">
                    <li id="dashboard" class="  ">
        <a href="/">
             <i class="fa fa-dashboard"></i>             <span>Control panel</span>
                                </a>

            </li>
    
                    <li id="os" class="  ">
        <a href="/app/map">
             <i class="fa fa-map"></i>             <span>Sevices map</span>
                                </a>

            </li>
    
                    <li id="eventsAll" class="  ">
        <a href="/events/">
             <i class="fa fa-calendar-check-o"></i>             <span>Event List</span>
                                </a>

            </li>
    
                    <li id="eventsAll2" class="  ">
        <a href="/user/list/">
             <i class="fa fa-users"></i>             <span>Users</span>
                                </a>

            </li>
    
    </ul>
                    </section>
        <!-- /.sidebar -->
    </aside>

    <!-- Right side column. Contains the navbar and content of the page -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Event List                <small>    Event List
</small>
            </h1>
                            <ol class="breadcrumb">
    <li>
        <a href="/">
            <i class="fa fa-dashboard"></i>
        </a>
    </li>
        <li class="active">Event List</li>
</ol>
                    </section>

        <!-- Main content -->
        <section class="content">
                <div class="row">
        <div class="col-md-12 connectedSortable">
            <div class="box box-success">
                <div class="box-header with-border">
                    <h3 class="box-title">Filter</h3>
                </div>
                <div class="box-body">
                 <form>
                    <div class="row">
                        <div class="col-md-2 col-sm-12">
                            Node: <select id="hosts" name="hostId">
                                <option></option>
                                                                    <option value="10107">Bondstreet</option>
                                                                    <option value="10125">ESB SPICE</option>
                                                                    <option value="10116">IEP: BO</option>
                                                                    <option value="10110">Marlboro</option>
                                                                    <option value="10113">Smartluxury</option>
                                                                </select>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            Object: <select id="scenario" name="scenarioId">
                                    <option></option>
                                </select>
                        </div>
                        <div class="col-md-1 col-sm-6">
                            <button type="button" class="btn btn-default" id="daterange-btn">
                                <span>
                                      <i class="fa fa-calendar"></i> Time period (Period)                                </span>
                                <i class="fa fa-caret-down"></i>
                            </button>
                        </div>
                    </div>
                 </form>

                </div>
            </div>
            <div id="top20events"><div class="box box-success">
    <div class="box-header">
        <h3 class="box-title"></h3>
        <div class="box-tools pull-right">
            <button class="btn btn-box-tool" data-widget="collapse">
                <i class="fa fa-minus"></i>
            </button>
        </div>
    </div>
    <div class="box-body">
		<div id="graphs">
			<div id="container" style="min-width: 310px; height: 200px; margin: 0 auto"></div>
		</div>
    </div>
    <!--<div class="overlay" id="spin">
        <i class="fa fa-refresh fa-spin"></i>
    </div>-->
</div></div>
        </div>
        <!-- </div>
         <div class="row">-->

    </div>

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

            <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <b>Версия</b> 1.1
            </div>
            <strong>Copyright &copy; 2014-2015 <a href="http://tivun.ru">Tivun</a>.</strong> All rights reserved.
        </footer>
    <div id="append"></div>
</div>
<!-- ./wrapper -->

        
    <script src="/bundles/avanzuadmintheme/static/prod/scripts/admin-lte-all.js"></script>
    <script type="text/javascript" src="/bundles/app/js/user.js"></script>



    <script>
Highcharts.chart('container', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'События на сервере'
    },
    xAxis: {
        categories: ['время1', 'время2', 'время3', 'время4', 'время5']
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Общее количество событий'
        },
        stackLabels: {
            enabled: true,
            style: {
                fontWeight: 'bold',
                color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
            }
        }
    },
    legend: {
        align: 'right',
        x: -30,
        verticalAlign: 'top',
        y: 25,
        floating: true,
        backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
        borderColor: '#CCC',
        borderWidth: 1,
        shadow: false
    },
    tooltip: {
        headerFormat: '<b>{point.x}</b><br/>',
        pointFormat: '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
    },
    plotOptions: {
        column: {
            stacking: 'normal',
            dataLabels: {
                enabled: false,
                color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white'
            }
        }
    },
    series: [{
        name: 'синий',
        data: [5, 3, 4, 7, 2]
    }, {
        name: 'желтый',
        data: [2, 2, 3, 2, 1]
    }, {
        name: 'зеленый',
        data: [3, 4, 4, 2, 5]
    }, {
        name: 'зеленый',
        data: [2, 3, 1, 3, 4]
    }, {
        name: 'зеленый',
        data: [3, 4, 4, 2, 5]
    }]
});
	  </script>
<script>
    $(function () {
        $('#daterange-btn').daterangepicker(
        {
            locale: {
            "format": "DD/MM/YYYY",
            "separator": " - ",
                        "firstDay": 1
            },
        ranges: {
        'Today': [moment(), moment()],
        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
        'Last 7 days': [moment().subtract(6, 'days'), moment()],
        'Last 30 days': [moment().subtract(29, 'days'), moment()],
        'This month': [moment().startOf('month'), moment().endOf('month')],
        'Previous month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        },
        startDate: moment(),
        endDate: moment()
        },
        function (start, end) {
        $('#daterange-btn span').html(start.format('DD.MM.YYYY') + ' - ' + end.format('DD.MM.YYYY'));
        }
        );

        $('#daterange-btn').on('apply.daterangepicker', function(ev, picker) {
            console.log(picker.startDate.format('YYYY-MM-DD'));
            console.log(picker.endDate.format('YYYY-MM-DD'));
            getTopevents();
        });
        $( "#hosts" ).change(function() {getScenarioList(this.value);getTopevents()});
        $( "#scenario" ).change(function() {getTopevents()});
    getTopevents();

    });

    function getScenarioList(hostId) {
        $.getJSON("/ajax/scenarios/"+hostId, function(result) {
        var options = $("#scenario");
        options.empty();
        options.append($("<option />").val(' ').text(' '));
        $.each(result, function(key,item) {
            options.append($("<option />").val(item.ht_name).text(item.ht_name));
            });
        });
    }
    getScenarioList($('#hosts').val());
    function getTopevents()
    {
        host=$('#hosts').val();
        scenario=$('#scenario').val();
        data=$('#daterange-btn').data('daterangepicker');
        from=data.startDate.format('YYYY-MM-DD');
        to=data.endDate.format('YYYY-MM-DD');

        $('#top20eventsspinner').show();
        $.ajax({url:"/ajax/allEvents?hostid="+host+"&scenario="+encodeURIComponent(scenario)+"&from="+from+"&to="+to+"&filter=stat", success:function( data ) {
        $('#top20events').html( data );
        $('#top20eventsspinner').hide();
            $('#events').DataTable({
                "paging": true,
                "pageLength": 30,
                "lengthChange": false,
                "searching": false,
                "ordering": true,
                "info": true,
                "autoWidth": true,
                language: {
                    url: '/ajax/datatableru'
                }
             });
        }})
    }
 </script>

</body>
</html>
